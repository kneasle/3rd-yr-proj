<!DOCTYPE html>
<html style="margin: 0; width: 100%; height: 100%">
    <head>
        <title>Composing Program</title>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
        <script src="cookies.js"></script>
        <script src="colors.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <!-- Note the usage of `type=module` here as this is an ES6 module -->
        <script type="module">
            import { Comp, default as init } from './proj.js';

            async function run() {
                await init('./proj_bg.wasm');
                window.Comp = Comp;
                start();
            }
            run();
        </script>
        <script>
            // Callback used by all collapse buttons
            function collapse(e) {
                // Replace the '-fold' at the end of the ID with '-area'
                const trimmed_id = e.id.slice(0, -"-fold".length);
                const selector = `${trimmed_id}-area`;
                // Find the element with this ID, returning and warning if it doesn't exist
                const fold_area = document.getElementById(selector);
                if (!fold_area) {
                    console.warn(`No elements found with selector "${selector}"`);
                    return;
                }
                // Update the state of this switch and the fold area
                const is_collapsed = fold_area.style.display === "none";
                e.innerText = is_collapsed ? "▼" : "▶";
                fold_area.style.display = is_collapsed ? "block" : "none";
            }
        </script>

        <!-- Main canvas -->
        <canvas id="comp-canvas"></canvas>

        <!-- Top-left HUD -->
        <div class="top-left-hud">
            <!-- Summary -->
            <p><span id="part-len">0</span> rows * <span
                id="num-parts">0</span> parts = <span id="num-rows">0</span> rows</p>
            <p><span id="falseness-info">true</span></p>

            <!-- Part Heads -->
            <hr/>
            <p><input id="part-head-input"></input></p>
            <p id="part-head-message" class="parse-err">Bell '2' repeated twice</p>
            <p>Viewing Part: <select name="part-head" id="part-head">
                <!-- The part heads are filled in only when the wasm is loaded, which is far enough
                     after page load to cause jank, so we fill this with a sensible default so that
                     hopefully the jank is less noticeable. -->
                <option value="0">#1: 12345678</option>
            </select></p>
        </div>

        <!-- Transpose box -->
        <div id="transpose-box">
            <p><input id="transpose-input"></input></p>
            <p id="transpose-message" class="parse-err">Bell '2' repeated twice</p>
        </div>

        <!-- Right sidebar -->
        <div id="right-sidebar">
            <div class="sidebar-box">
                <h2><span class="fold-button"
                          id="method-box-fold"
                          onclick="collapse(this);"
                    >▼</span>Methods (<span id="num-methods">0</span>)</h2>
                <div id="method-box-area">
                    <div id="method-list">
                        <!-- Method entries will go here -->
                    </div>
                    <p>Select method: <input id="selected-method"
                                           style="width: 2em;"
                                           type="number"
                                           value="0"
                                           min="0"/></p>
                </div>
            </div>

            <div class="sidebar-box">
                <h2 style="margin-top: 0; text-align: center;">TEMPORARY:</h2>

                <p id="call-readout">&lt;Calls&gt;</p>

                <p>Select call: <input id="selected-call"
                    style="width: 2em;" type="number" value="0" min="-1"></input>
                </p>
            </div>
        </div>

        <!-- Templates (i.e. HTML trees which will get cloned and populated with data to generate
             the sidebar).  These are very reminiscent of templates from Vue or React except that
             the interactions we require are very simple and are easier managed without a
             library. -->
        <div style="display: none;" id="templates">
            <!-- Template for a single method entry -->
            <div id="template-method-entry">
                <!-- Title bar: Shorthand & name on the left -->
                <p><span class="fold-button"
                         id="method-info-fold-btn">▶</span>(<span id="shorthand">B</span>)
                    <span id="name">Bristol</span>
                    <!-- row counter/delete on the right -->
                    <span style="float: right;">
                        <span id="row-count" style="display: none;">0 rows</span>
                        <span id="delete-button"
                              style="color: #0000ff; text-decoration: underline; cursor: pointer;"
                        >remove</span>
                    </span>
                </p>
                <!-- Fold out section (hidden by default) -->
                <div class="method-fold-out" id="method-info-area">
                    <table style="width: 100%;">
                        <tr>
                            <td style="display: flex; flex-direction: row;">
                                <input id="shorthand-input"
                                       value="V"
                                       placeholder="Sym"
                                       style="width: 2em; margin-right: 5px;" />
                                <input id="name-input"
                                       placeholder="Name"
                                       value="Deva"
                                       style="flex: 1;" />
                            </td>
                        </tr>
                        <tr>
                            <td style="display: flex; flex-direction: row;">
                                <input id="place-notation-input"
                                       value="<PLACE NOTATION>"
                                       placeholder="Place Notation"
                                       style="flex: 1;"
                                       disabled />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Load the main JS script after the rest of the document has loaded.  We do this so that
             we can initialise references to the HTML elements as global constants for the JS code
             to re-use. -->
        <script src="index.js"></script>
    </body>
</html>
